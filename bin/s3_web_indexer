#!/usr/bin/env/ruby
# frozen_string_literal: true

require 'optparse'
require 'quick_and_ruby/s3_web_indexer'

options = {
  path: '/',
  recursivbe: false
}
option_parser = OptionParser.new do |opt|
  opt.banner = 'Usage: s3_web_indexer [options]'

  opt.on('-b', '--bucket BUCKET', 'S3 bucket name') { |v| options[:bucket] = v }
  opt.on('-u', '--url URL', 'S3 endpoint URL') { |v| options[:url] = v }
  opt.on('-a', '--access-key KEY', 'S3 access key') { |v| options[:access_key] = v }
  opt.on('-s', '--secret-key KEY', 'S3 secret access key') { |v| options[:secret_key] = v }
  opt.on('-p', '--path PATH', 'Bucket path (prefix)') { |v| options[:path] = v }
  opt.on('-r', '--recursive', 'Scan recursively') { |_v| options[:recursive] = true }
end

argv = ARGV.clone
option_parser.parse!(argv)

abort('Missing required arguments') unless options.values_at(:bucket, :url, :access_key,
                                                             :secret_key, :path).all?

exit QuickAndRuby::S3WebIndexer.new(options: options).index
